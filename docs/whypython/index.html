<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Need for Speed: Accelerating Python with sprinkles of C&#43;&#43; | A Journey Towards Deeper Understanding</title>
<meta name="keywords" content="">
<meta name="description" content="Get out of the python For building performant system python is not really a good language. There are many lacking factors in python which makes it difficult to use for production level systems.
Drawbacks of python Python is not a compiled language. Python is not a statically typed language. Python is not very parallelisable cause of GIL (Global Interpreter Lock). Pros of python Python is very easy to learn. Python is good for prototyping and small scale projects.">
<meta name="author" content="">
<link rel="canonical" href="http://aineedattention.blog/docs/whypython/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://aineedattention.blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://aineedattention.blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://aineedattention.blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://aineedattention.blog/apple-touch-icon.png">
<link rel="mask-icon" href="http://aineedattention.blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Need for Speed: Accelerating Python with sprinkles of C&#43;&#43;" />
<meta property="og:description" content="Get out of the python For building performant system python is not really a good language. There are many lacking factors in python which makes it difficult to use for production level systems.
Drawbacks of python Python is not a compiled language. Python is not a statically typed language. Python is not very parallelisable cause of GIL (Global Interpreter Lock). Pros of python Python is very easy to learn. Python is good for prototyping and small scale projects." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://aineedattention.blog/docs/whypython/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2024-03-11T04:42:21+05:30" />
<meta property="article:modified_time" content="2024-03-11T04:42:21+05:30" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Need for Speed: Accelerating Python with sprinkles of C&#43;&#43;"/>
<meta name="twitter:description" content="Get out of the python For building performant system python is not really a good language. There are many lacking factors in python which makes it difficult to use for production level systems.
Drawbacks of python Python is not a compiled language. Python is not a statically typed language. Python is not very parallelisable cause of GIL (Global Interpreter Lock). Pros of python Python is very easy to learn. Python is good for prototyping and small scale projects."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Docs",
      "item": "http://aineedattention.blog/docs/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Need for Speed: Accelerating Python with sprinkles of C++",
      "item": "http://aineedattention.blog/docs/whypython/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Need for Speed: Accelerating Python with sprinkles of C++",
  "name": "Need for Speed: Accelerating Python with sprinkles of C\u002b\u002b",
  "description": "Get out of the python For building performant system python is not really a good language. There are many lacking factors in python which makes it difficult to use for production level systems.\nDrawbacks of python Python is not a compiled language. Python is not a statically typed language. Python is not very parallelisable cause of GIL (Global Interpreter Lock). Pros of python Python is very easy to learn. Python is good for prototyping and small scale projects.",
  "keywords": [
    
  ],
  "articleBody": "Get out of the python For building performant system python is not really a good language. There are many lacking factors in python which makes it difficult to use for production level systems.\nDrawbacks of python Python is not a compiled language. Python is not a statically typed language. Python is not very parallelisable cause of GIL (Global Interpreter Lock). Pros of python Python is very easy to learn. Python is good for prototyping and small scale projects. Python has really good libraries for data science and machine learning like numpy, pandas, scikit-learn, tensorflow, keras etc. How does performant libraries like numpy, pandas, scikit-learn etc. work? These libraries are written in C/C++ and wrapped with python. So, the core computation is done in C/C++ and the python is used for the high level abstraction and user interface. This gives the best of both worlds. The performance of C/C++ and the ease of python. :)\nHow to write code in C/C++ and use it in python? There are many ways to do this. The most common way is to use the pythonâ€™s ctypes library. But, this is not the best way to do this. The best way to do this is to use the pybind11 library. This library is very easy to use and provides a very good interface to write C++ code and use it in python.\npybind11 is also used in popular libraries like pytorch and pandas.\nHow to use pybind11? Lets start with torch extensions library. This library is used to write custom layers and functions in pytorch. This library is written in C++ and uses pybind11 to use it in python.\nLets import the required libraries import torch import random ### load inline function makes it easier to import c++ code into python. ### It abstracts away the need to write a setup.py file and ### the need to compile the code separately. from torch.utils.cpp_extension import load_inline Lets implement naive solution for merge sort in python. # Implement merge sort in python def merge_sort_py(arr): if len(arr) \u003e 1: mid = len(arr) // 2 L = arr[:mid] R = arr[mid:] merge_sort_py(L) merge_sort_py(R) i = j = k = 0 while i \u003c len(L) and j \u003c len(R): if L[i] \u003c R[j]: arr[k] = L[i] i += 1 else: arr[k] = R[j] j += 1 k += 1 while i \u003c len(L): arr[k] = L[i] i += 1 k += 1 while j \u003c len(R): arr[k] = R[j] j += 1 k += 1 return arr Lets write the c++ code for merge sort and use it in python using torch extension library. cpp_source = ''' #include std::vector merge_sort_cpp(std::vector arr) { if (arr.size() \u003e 1) { int mid = arr.size() / 2; std::vector L(arr.begin(), arr.begin() + mid); std::vector R(arr.begin() + mid, arr.end()); L = merge_sort_cpp(L); R = merge_sort_cpp(R); int i = 0; int j = 0; int k = 0; while (i \u003c L.size() \u0026\u0026 j \u003c R.size()) { if (L[i] \u003c R[j]) { arr[k] = L[i]; i++; } else { arr[k] = R[j]; j++; } k++; } while (i \u003c L.size()) { arr[k] = L[i]; i++; k++; } while (j \u003c R.size()) { arr[k] = R[j]; j++; k++; } } return arr; } ''' Lets use the load_inline function to use the c++ code in python. This will compile the c++ code and use it in python as a module. In this case the module name is merge_sort_cpp. merge_sort_cpp = load_inline( name = 'merge_sort_cpp', cpp_sources = [cpp_source], functions = ['merge_sort_cpp'], verbose= True, build_directory='.' ) Lets test the c++ code with the python code. Notice how List[int] got converted to std::vector and the return type got converted to List[int]. test_data = [5,1,3,2,4] result = merge_sort_cpp.merge_sort_cpp(test_data) assert result == sorted(merge_sort_py(test_data)) == [1,2,3,4,5] Lets do performance comparison between the python and c++ code. For x axis we will use the size of the array and for y axis we will use the time taken to sort the array.\nimport matplotlib.pyplot as plt import numpy as np import time test_data_sizes = [10**i for i in range(2, 9)] test_data_legend = [i for i in range(2, 9)] python_runtimes = [] for size in test_data_sizes: test_input = random.sample(range(10**9), size) start_time = time.time() merge_sort_py(test_input) python_runtimes.append(time.time() - start_time) cpp_runtimes = [] for size in test_data_sizes: test_input = random.sample(range(10**9), size) start_time = time.time() merge_sort_cpp.merge_sort_cpp(test_input) cpp_runtimes.append(time.time() - start_time) plt.plot(test_data_legend, python_runtimes, marker='o', label='Python') plt.plot(test_data_legend, cpp_runtimes, marker='o', label='C++') plt.xlabel('Input Size 10^') plt.ylabel('Runtime (seconds)') plt.title('Merge Sort Runtime') plt.legend() plt.show() As we can see from the plot, the c++ code is much faster than the python code. In the next blog post we will see how to use pybind11 to write c++ code and use it in python. We will also see how to circumvent the GIL and write parallel code in python using c++.\n",
  "wordCount" : "793",
  "inLanguage": "en",
  "datePublished": "2024-03-11T04:42:21+05:30",
  "dateModified": "2024-03-11T04:42:21+05:30",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://aineedattention.blog/docs/whypython/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "A Journey Towards Deeper Understanding",
    "logo": {
      "@type": "ImageObject",
      "url": "http://aineedattention.blog/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://aineedattention.blog/" accesskey="h" title="A Journey Towards Deeper Understanding (Alt + H)">A Journey Towards Deeper Understanding</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Need for Speed: Accelerating Python with sprinkles of C&#43;&#43;
    </h1>
    <div class="post-meta"><span title='2024-03-11 04:42:21 +0530 +0530'>March 11, 2024</span>

</div>
  </header> 
  <div class="post-content"><h2 id="get-out-of-the-python">Get out of the python<a hidden class="anchor" aria-hidden="true" href="#get-out-of-the-python">#</a></h2>
<p>For building performant system python is not really a good language. There are
many lacking factors in python which makes it difficult to use for production
level systems.</p>
<h2 id="drawbacks-of-python">Drawbacks of python<a hidden class="anchor" aria-hidden="true" href="#drawbacks-of-python">#</a></h2>
<ol>
<li>Python is not a compiled language.</li>
<li>Python is not a statically typed language.</li>
<li>Python is not very parallelisable cause of GIL (Global Interpreter Lock).</li>
</ol>
<h2 id="pros-of-python">Pros of python<a hidden class="anchor" aria-hidden="true" href="#pros-of-python">#</a></h2>
<ol>
<li>Python is very easy to learn.</li>
<li>Python is good for prototyping and small scale projects.</li>
<li>Python has really good libraries for data science and machine learning like
numpy, pandas, scikit-learn, tensorflow, keras etc.</li>
</ol>
<h2 id="how-does-performant-libraries-like-numpy-pandas-scikit-learn-etc-work">How does performant libraries like numpy, pandas, scikit-learn etc. work?<a hidden class="anchor" aria-hidden="true" href="#how-does-performant-libraries-like-numpy-pandas-scikit-learn-etc-work">#</a></h2>
<p>These libraries are written in C/C++ and wrapped with python. So, the core
computation is done in C/C++ and the python is used for the high level
abstraction and user interface.
This gives the best of both worlds. The performance of C/C++ and the ease of
python. :)</p>
<h2 id="how-to-write-code-in-cc-and-use-it-in-python">How to write code in C/C++ and use it in python?<a hidden class="anchor" aria-hidden="true" href="#how-to-write-code-in-cc-and-use-it-in-python">#</a></h2>
<p>There are many ways to do this. The most common way is to use the python&rsquo;s
<code>ctypes</code> library. But, this is not the best way to do this. The best way to do
this is to use the <code>pybind11</code> library. This library is very easy to use and
provides a very good interface to write C++ code and use it in python.</p>
<p>pybind11 is also used in popular libraries like <code>pytorch</code> and <code>pandas</code>.</p>
<h2 id="how-to-use-pybind11">How to use pybind11?<a hidden class="anchor" aria-hidden="true" href="#how-to-use-pybind11">#</a></h2>
<p>Lets start with torch extensions library. This library is used to write custom
layers and functions in pytorch. This library is written in C++ and uses
pybind11 to use it in python.</p>
<h3 id="lets-import-the-required-libraries">Lets import the required libraries<a hidden class="anchor" aria-hidden="true" href="#lets-import-the-required-libraries">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#75715e">### load inline function makes it easier to import c++ code into python. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### It abstracts away the need to write a setup.py file and </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### the need to compile the code separately.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torch.utils.cpp_extension <span style="color:#f92672">import</span> load_inline
</span></span></code></pre></div><h3 id="lets-implement-naive-solution-for-merge-sort-in-python">Lets implement naive solution for merge sort in python.<a hidden class="anchor" aria-hidden="true" href="#lets-implement-naive-solution-for-merge-sort-in-python">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Implement merge sort in python    </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">merge_sort_py</span>(arr):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(arr) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        mid <span style="color:#f92672">=</span> len(arr) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        L <span style="color:#f92672">=</span> arr[:mid]
</span></span><span style="display:flex;"><span>        R <span style="color:#f92672">=</span> arr[mid:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        merge_sort_py(L)
</span></span><span style="display:flex;"><span>        merge_sort_py(R)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> j <span style="color:#f92672">=</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> len(L) <span style="color:#f92672">and</span> j <span style="color:#f92672">&lt;</span> len(R):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> L[i] <span style="color:#f92672">&lt;</span> R[j]:
</span></span><span style="display:flex;"><span>                arr[k] <span style="color:#f92672">=</span> L[i]
</span></span><span style="display:flex;"><span>                i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                arr[k] <span style="color:#f92672">=</span> R[j]
</span></span><span style="display:flex;"><span>                j <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            k <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> len(L):
</span></span><span style="display:flex;"><span>            arr[k] <span style="color:#f92672">=</span> L[i]
</span></span><span style="display:flex;"><span>            i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            k <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> j <span style="color:#f92672">&lt;</span> len(R):
</span></span><span style="display:flex;"><span>            arr[k] <span style="color:#f92672">=</span> R[j]
</span></span><span style="display:flex;"><span>            j <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            k <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> arr
</span></span></code></pre></div><h3 id="lets-write-the-c-code-for-merge-sort-and-use-it-in-python-using-torch-extension-library">Lets write the c++ code for merge sort and use it in python using torch extension library.<a hidden class="anchor" aria-hidden="true" href="#lets-write-the-c-code-for-merge-sort-and-use-it-in-python-using-torch-extension-library">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>cpp_source <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#include &lt;vector&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">std::vector&lt;int&gt; merge_sort_cpp(std::vector&lt;int&gt; arr) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    if (arr.size() &gt; 1) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        int mid = arr.size() / 2;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        std::vector&lt;int&gt; L(arr.begin(), arr.begin() + mid);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        std::vector&lt;int&gt; R(arr.begin() + mid, arr.end());
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        L = merge_sort_cpp(L);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        R = merge_sort_cpp(R);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        int i = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        int j = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        int k = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        while (i &lt; L.size() &amp;&amp; j &lt; R.size()) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            if (L[i] &lt; R[j]) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                arr[k] = L[i];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                i++;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            } else {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                arr[k] = R[j];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                j++;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            k++;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        while (i &lt; L.size()) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            arr[k] = L[i];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            i++;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            k++;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        while (j &lt; R.size()) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            arr[k] = R[j];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            j++;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            k++;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    return arr;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span></code></pre></div><h3 id="lets-use-the-load_inline-function-to-use-the-c-code-in-python-this-will-compile-the-c-code-and-use-it-in-python-as-a-module-in-this-case-the-module-name-is-merge_sort_cpp">Lets use the <code>load_inline</code> function to use the c++ code in python. This will compile the c++ code and use it in python as a module. In this case the module name is <code>merge_sort_cpp</code>.<a hidden class="anchor" aria-hidden="true" href="#lets-use-the-load_inline-function-to-use-the-c-code-in-python-this-will-compile-the-c-code-and-use-it-in-python-as-a-module-in-this-case-the-module-name-is-merge_sort_cpp">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>merge_sort_cpp <span style="color:#f92672">=</span> load_inline(
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;merge_sort_cpp&#39;</span>,
</span></span><span style="display:flex;"><span>    cpp_sources <span style="color:#f92672">=</span> [cpp_source],
</span></span><span style="display:flex;"><span>    functions <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;merge_sort_cpp&#39;</span>],
</span></span><span style="display:flex;"><span>    verbose<span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    build_directory<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;.&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h3 id="lets-test-the-c-code-with-the-python-code-notice-how-listint-got-converted-to-stdvectorint-and-the-return-type-got-converted-to-listint">Lets test the c++ code with the python code. Notice how List[int] got converted to std::vector<!-- raw HTML omitted --> and the return type got converted to List[int].<a hidden class="anchor" aria-hidden="true" href="#lets-test-the-c-code-with-the-python-code-notice-how-listint-got-converted-to-stdvectorint-and-the-return-type-got-converted-to-listint">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>test_data <span style="color:#f92672">=</span> [<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> merge_sort_cpp<span style="color:#f92672">.</span>merge_sort_cpp(test_data)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> result <span style="color:#f92672">==</span> sorted(merge_sort_py(test_data)) <span style="color:#f92672">==</span> [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>]
</span></span></code></pre></div><p>Lets do performance comparison between the python and c++ code.
For x axis we will use the size of the array and for y axis we will use the time
taken to sort the array.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test_data_sizes <span style="color:#f92672">=</span> [<span style="color:#ae81ff">10</span><span style="color:#f92672">**</span>i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">9</span>)]
</span></span><span style="display:flex;"><span>test_data_legend <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">9</span>)]
</span></span><span style="display:flex;"><span>python_runtimes <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> size <span style="color:#f92672">in</span> test_data_sizes:
</span></span><span style="display:flex;"><span>    test_input <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>sample(range(<span style="color:#ae81ff">10</span><span style="color:#f92672">**</span><span style="color:#ae81ff">9</span>), size)
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    merge_sort_py(test_input)
</span></span><span style="display:flex;"><span>    python_runtimes<span style="color:#f92672">.</span>append(time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cpp_runtimes <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> size <span style="color:#f92672">in</span> test_data_sizes:
</span></span><span style="display:flex;"><span>    test_input <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>sample(range(<span style="color:#ae81ff">10</span><span style="color:#f92672">**</span><span style="color:#ae81ff">9</span>), size)
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>    merge_sort_cpp<span style="color:#f92672">.</span>merge_sort_cpp(test_input)
</span></span><span style="display:flex;"><span>    cpp_runtimes<span style="color:#f92672">.</span>append(time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start_time)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(test_data_legend, python_runtimes, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Python&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(test_data_legend, cpp_runtimes, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;C++&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Input Size 10^&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Runtime (seconds)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Merge Sort Runtime&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>legend()
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()
</span></span></code></pre></div><p><img loading="lazy" src="/docs/f00816e7cc168cd244791548e80bae416cba803b.png" alt="plot"  title="### Title"  />
</p>
<p>As we can see from the plot, the c++ code is much faster than the python code.
In the next blog post we will see how to use pybind11 to write c++ code and use
it in python. We will also see how to circumvent the GIL and write parallel
code in python using c++.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://aineedattention.blog/">A Journey Towards Deeper Understanding</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
